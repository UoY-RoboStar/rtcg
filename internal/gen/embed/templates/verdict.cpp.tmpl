{{/*
verdict.cpp.tmpl expands into the verdict storage class.

It expects a slice of test ID strings as its dot.
*/}}
// Records information about test verdicts.
class Verdict
{
public:
  void dump();
  void set(Test t, rtcg::Outcome new_val);
private:
  std::array<rtcg::Outcome, NUM_TESTS> test_outcomes;
};

void Verdict::dump()
{
{{- block "verdict_dump" . }}
  {{ template "log" "info" }}("final outcomes: \n");
{{-   range . }}
  {{ template "log" "info" }}("  {{ .}} = %s\n", rtcg::outstr(test_outcomes[static_cast<size_t>({{ cppTestEnum . }})]));
{{-   end }}
{{- end }}
}

void Verdict::set(Test t, rtcg::Outcome new_val)
{
  auto i = static_cast<size_t>(t);

  auto old_val = test_outcomes[i];
  if (old_val == new_val)
    return;

  test_outcomes[i] = new_val;
  {{ template "log" "info" }}("test %s is now %s (was %s)\n", testName(t), rtcg::outstr(new_val), rtcg::outstr(old_val));
}