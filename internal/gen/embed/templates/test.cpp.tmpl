{{/*
test.cpp.tmpl expands into the body of a state function.

It expects the state in question as its dot.
*/}}

{{- range $s, $ts := .Verdicts }}
{{-   range $ts.Tests.Values }}
  verdict.set({{ cppTestEnum . }}, {{ cppOutcomeEnum $s }});
{{-   end }}
{{- end }}
{{ if .Verdicts.IsFail }}
  return State::FAIL; // This state fails at least one test
{{- else -}}
{{-   range .TransitionSets }}
  // TODO: transition set {{ .Channel }}
  auto value = 1;
{{-     range .Transitions }}
  if (value == 1) // TODO: value == {{ .Value }}
    return {{ cppStateEnum .Next }};
{{-     end }}

  // TODO: fell off without reaching a transition, do something useful here
  return State::FAIL;
{{-   else }}
  // no transitions remaining
  // TODO: make sure we don't spot something here
  return State::TIMEOUT;
{{-   end }}
{{- end -}}
